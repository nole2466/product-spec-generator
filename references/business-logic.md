# 商業邏輯規範

> 定義產品的核心業務規則，確保所有角色對「業務怎麼運作」有一致理解

---

## 為什麼需要商業邏輯文件？

| 問題 | 解法 |
|-----|------|
| RD 不懂業務規則，實作錯誤 | 明確定義業務規則 |
| 各角色對規則理解不一致 | 統一的 Source of Truth |
| 規則散落在各處，難以維護 | 集中管理，易於查找 |
| 新人 onboarding 困難 | 完整的業務知識庫 |
| AI 無法理解業務脈絡 | 提供 Context 給 AI |

---

## 文件結構

```
knowledge/
├── business/                    # 商業邏輯
│   ├── _index.md               # 總覽和導航
│   ├── core-concepts.md        # 核心概念定義
│   ├── rules/                  # 業務規則
│   │   ├── pricing.md          # 定價與折扣規則
│   │   ├── membership.md       # 會員等級規則
│   │   ├── promotion.md        # 促銷活動規則
│   │   └── refund.md           # 退款與取消規則
│   ├── workflows/              # 業務流程
│   │   ├── order-flow.md       # 訂單流程
│   │   ├── payment-flow.md     # 付款流程
│   │   └── fulfillment.md      # 履約流程
│   └── glossary.md             # 業務術語表
│
└── domain/                      # 知識領域（見 domain-knowledge.md）
```

---

## 核心概念定義（core-concepts.md）

定義產品中的核心實體和關係，讓所有人對「系統裡有什麼」有共識。

### 撰寫原則

1. **列出所有核心實體**：用戶、訂單、商品等
2. **定義實體屬性**：每個欄位的意義和規則
3. **描述實體關係**：用 ER 圖呈現
4. **定義狀態機**：有狀態變化的實體要畫出狀態圖

### 範本

```markdown
# 核心概念定義

## 實體關係圖

（使用 Mermaid ER Diagram 呈現實體關係）

## 核心實體

### {實體名稱}

| 屬性 | 說明 | 業務規則 |
|-----|------|---------|
| id | 唯一識別碼 | 格式規則 |
| name | 名稱 | 長度限制、唯一性 |
| status | 狀態 | 可能的值 |

**狀態機**：
（描述狀態之間如何轉換）

**業務規則**：
- 規則 1
- 規則 2
```

---

## 業務規則（rules/）

定義具體的業務規則，每個規則要有明確的**觸發條件**和**行為**。

### 撰寫原則

1. **一個檔案一個主題**：定價、會員、退款分開
2. **規則要可執行**：寫清楚條件和結果
3. **包含計算公式**：用 pseudocode 或公式呈現
4. **列出邊界情況**：特例和例外怎麼處理

### 範本

```markdown
# {主題} 規則

## 規則總覽

（簡述這類規則的目的）

## 規則 1：{規則名稱}

**觸發條件**：
- 條件 A
- 條件 B

**執行邏輯**：
（用 pseudocode 或流程描述）

**結果**：
- 正常情況
- 異常情況

## 規則 2：{規則名稱}

...
```

### 常見業務規則類型

| 類型 | 範例 | 常見內容 |
|-----|------|---------|
| 定價規則 | 折扣計算、運費計算 | 公式、優先順序、上下限 |
| 會員規則 | 升降級、權益 | 門檻、週期、權益清單 |
| 促銷規則 | 滿減、折扣碼 | 疊加規則、使用限制 |
| 退款規則 | 取消、退貨 | 時效、條件、金額計算 |
| 庫存規則 | 扣減、預留 | 時機、歸還條件 |
| 通知規則 | 何時發什麼通知 | 觸發條件、通知內容 |

---

## 業務流程（workflows/）

定義完整的業務流程，包含正常流程和異常處理。

### 撰寫原則

1. **用狀態機描述**：清楚呈現狀態轉換
2. **定義每個狀態**：能做什麼、不能做什麼
3. **列出觸發條件**：什麼情況下狀態會改變
4. **包含異常處理**：出錯時怎麼辦

### 範本

```markdown
# {流程名稱}

## 流程圖

（使用 Mermaid State Diagram）

## 狀態說明

| 狀態 | 說明 | 可執行動作 | 自動觸發 |
|-----|------|----------|---------|
| 狀態 A | | | |
| 狀態 B | | | |

## 流程步驟

1. 步驟一
   - 檢查項目
   - 執行動作
   
2. 步驟二
   ...

## 異常處理

| 異常 | 處理方式 | 用戶提示 |
|-----|---------|---------|
| | | |
```

### 常見業務流程

| 流程 | 說明 |
|-----|------|
| 訂單流程 | 從下單到完成的完整生命週期 |
| 付款流程 | 付款、確認、失敗處理 |
| 履約流程 | 出貨、配送、簽收 |
| 退款流程 | 申請、審核、退款 |
| 註冊流程 | 註冊、驗證、啟用 |
| 審核流程 | 提交、審核、核准/駁回 |

---

## 業務術語表（glossary.md）

統一團隊用語，避免溝通誤解。

### 撰寫原則

1. **按主題分類**：訂單、商品、付款等
2. **包含英文對照**：方便 API 命名
3. **給出明確定義**：避免歧義
4. **提供範例**：幫助理解

### 範本

```markdown
# 業務術語表

## {主題} 相關

| 術語 | 英文 | 定義 | 範例 |
|-----|------|------|------|
| 術語 A | English | 定義說明 | 具體範例 |
```

---

## 在 spec 中引用

在 spec.md 中引用商業邏輯，避免重複撰寫：

```markdown
## 業務規則

本功能遵循以下業務規則：

- [定價規則](../knowledge/business/rules/pricing.md)
- [退款規則](../knowledge/business/rules/refund.md)
- [訂單流程](../knowledge/business/workflows/order-flow.md)

### 本功能特殊規則

（只寫這個功能特有的規則）
```

---

## AI 協作指南

### 讓 AI 理解業務脈絡

**Prompt 範本**：

```
請先閱讀以下業務規則，再幫我設計功能：

核心概念：
{core-concepts.md 內容}

相關規則：
{相關規則檔案內容}

現在請幫我設計「{功能名稱}」的規格，
確保符合上述業務規則。
```

### 讓 AI 幫你整理業務規則

**Prompt 範本**：

```
請幫我整理以下業務規則，使用標準格式：

{口述或零散的規則}

請產出：
1. 規則名稱
2. 觸發條件
3. 執行邏輯（可用 pseudocode）
4. 異常處理
5. 用戶提示訊息
```

### 讓 AI 檢查規則一致性

**Prompt 範本**：

```
請檢查以下規格是否符合業務規則：

spec.md：
{內容}

業務規則：
{相關規則}

請列出：
1. 符合的規則
2. 違反的規則
3. 未涵蓋的規則
```
